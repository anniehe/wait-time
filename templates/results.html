{% extends 'base.html' %}
{% block head %}

  <title>Results</title>

  <style>
    html, body {
      height: 100%;
    }

    #map {
      height: 50%;
      width: 50%;
    }
  </style>

  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="/static/js/map.js"></script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initMap">
  </script>

{% endblock %}


{% block body %}

  <!-- Search Form -->
  <form action="/search" method="GET">
    <input type="text" name="keyword" placeholder="Restaurant/Food">
    <input type="text" name="location" placeholder="Location/City/Zipcode">
    <input type="submit" value="Find wait time!">
  </form>


  <!-- Map -->
  <div id="map"></div>

  <!-- List Results -->

  <!-- Each business is a dictionary in result (list of businesses) -->
  {% for business in result %}
    <div>
      <h2>{{ business['name'] }}</h2>

      <p>{{ business['location']['address'][0] }}, {{ business['location']['city'] }}, {{ business['location']['state_code'] }} {{ business['location']['postal_code'] }}</p>
      
      <p>Quoted Wait Time: 
        {% if business['quoted_wait_time'] != "Not available" %}
          <!-- e.g. 45 min -->
          {% if business['quoted_wait_time'] < 60 %}
            {{ business['quoted_wait_time'] }} min
          <!-- e.g. 1 hr or 2 hr -->
          {% elif business['quoted_wait_time'] >= 60 and 
              business['quoted_wait_time'] % 60 == 0 %}
            {{ business['quoted_wait_time'] // 60 }} hr
          <!-- e.g. 2 hr 15 min -->
          {% elif business['quoted_wait_time'] > 60 and 
              business['quoted_wait_time'] % 60 != 0 %}
            {{ business['quoted_wait_time'] // 60 }} hr {{ business['quoted_wait_time'] % 60 }} min
          {% endif %}
        {% else %}
          {{ business['quoted_wait_time'] }}
        {% endif %}
      </p>
      <p>Party Size: {{ business['party_size'] }}</p>
      <p>Parties Ahead: {{ business['parties_ahead'] }}</p>
      <p>Reported: {{ business['timestamp'] }}</p>

      <p><img src="{{ business['rating_img_url'] }}"/> {{ business['review_count'] }} reviews</p>
      <p><a href="{{ business['url'] }}" target="_blank"><img src="/static/img/yelp_review_btn_light.png"/></a></p>
      
      {% if business['opening_hours'] %}
        <p>Hours
        <ul>
          {% for day in business['opening_hours'] %}
            <li>{{ day }}</li>
          {% endfor %}
        </ul>
        </p>
      {% else %}
        <p>Hours not available</p>
      {% endif %}

      <p>{{ business['open_now'] }}</p>
    <br>

  </div>
  {% endfor %}

  <script>
    $.get("/results.json", function(data) {
      console.log(data);
    });
  </script>

{% endblock %}